<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="/static/image/icon/favicon.ico">
    
    <!-- OneTrust Cookies Consent Notice start for www.fermyon.com -->
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="019b08a9-d070-725d-a68c-7db8a39f4d6b" ></script>
    <script type="text/javascript">
    function OptanonWrapper() { }
    </script>
    <!-- OneTrust Cookies Consent Notice end for www.fermyon.com -->
    <style>
        #onetrust-banner-sdk.ot-bnr-w-logo .ot-bnr-logo {
            height: auto !important;
        }
    </style>

    <script data-type="application/javascript" type="text/plain" data-name="google-tag-manager">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T28H3XL');</script>

    <!-- meta tags: base -->
    <title>Looking Ahead to WASIp3</title>
    <meta name="description" content="A look at Preview 3 (WASIp3) the next major release of WASI - which brings composable concurrency to Wasm components.">
    <meta name="author" content="page.head.extra.author">
    <meta name="keywords"
        content="wasi, wasm, webassembly, ">

    <!-- meta tags: open graph -->
    <meta property="og:url" name="url" content="/blog/looking-ahead-to-wasip3">
    <meta property="og:type" name="type" content="article">
    <meta property="og:title" name="title" content="Looking Ahead to WASIp3">
    <meta property="og:description" name="description" content="A look at Preview 3 (WASIp3) the next major release of WASI - which brings composable concurrency to Wasm components.">
    <meta property="og:image" name="image" content="/static/image/twc-wasip3.jpg">
    <meta property="og:locale" name="locale" content="en_US">
    <meta property="og:site_name" name="site" content="Fermyon ‚Ä¢ Experience the next wave of cloud computing.">

    <!-- meta tags: search engine -->
    <meta itemprop="name" content="Looking Ahead to WASIp3">
    <meta itemprop="description" content="A look at Preview 3 (WASIp3) the next major release of WASI - which brings composable concurrency to Wasm components.">
    <meta itemprop="image" content="/static/image/twc-wasip3.jpg">

    <!-- meta tags: twitter -->
    <meta name="twitter:title" content="Looking Ahead to WASIp3">
    <meta name="twitter:description" content="A look at Preview 3 (WASIp3) the next major release of WASI - which brings composable concurrency to Wasm components.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="/static/image/twc-wasip3.jpg">
    <meta property="twitter:url" content="/blog/looking-ahead-to-wasip3">

    <!-- meta tags: rss -->
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content=" 2025-03-13T12:00:00Z">
    <meta property="article:modified_time" content=" 2025-03-13T12:00:00Z">

    <link rel="icon" type="image/png" href="/static/image/icon/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/image/icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/image/icon/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/image/icon/apple-touch-icon.png">
    <link rel="manifest" href="/static/image/icon/site.webmanifest">
    <link rel="mask-icon" href="/static/image/icon/safari-pinned-tab.svg" color="#0d203f">
    <meta name="msapplication-TileColor" content="#0d203f">
    <meta name="theme-color" content="#ffffff">

    <link rel="alternate" type="application/rss+xml" title="Fermyon ‚Ä¢ Experience the next wave of cloud computing." href="/atom.xml">
    <link rel="canonical" href="/blog/looking-ahead-to-wasip3">
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600&display=swap" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css"
        integrity="sha512-IgmDkwzs96t4SrChW29No3NXBIBv8baW490zk5aXvhCD8vuZM3yUSkbyTBcXohkySecyzIrUwiF/qV0cuPcL3Q=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;600&amp;display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css" />
    <!-- dak/light mode -->
    <script>
        const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";

        // The default theme is the system theme, unless the user has explicitly overridden it.
        var savedTheme = localStorage.getItem("theme") || systemTheme;
        setTheme(savedTheme);

        document.addEventListener("DOMContentLoaded", () => {
            const btn = document.querySelector(".dark-mode");
            btn.addEventListener("click", () => {
                if (savedTheme === "dark") {
                    setTheme("light");
                } else if (savedTheme === "light") {
                    setTheme("dark");
                }
            });
        })

        // Change the website theme when the system theme changes.
        window
            .matchMedia("(prefers-color-scheme: dark)")
            .addEventListener("change", (event) => {
                if (event.matches) {
                    setTheme("dark");
                } else {
                    setTheme("light");
                }
            });

        // Change the website theme when a different tab changed it.
        window.onstorage = () => {
            // When local storage changes, update the theme.
            setTheme(localStorage.getItem("theme"));
        };


        function setTheme(mode) {
            localStorage.setItem("theme", mode);
            savedTheme = mode;
            document.documentElement.classList.toggle('dark-theme', mode === "dark");
        }
    </script>
    <!-- Start of Posthog script -->
    <script data-type="application/javascript" data-name="posthog">
        !function (t, e) { var o, n, p, r; e.__SV || (window.posthog = e, e._i = [], e.init = function (i, s, a) { function g(t, e) { var o = e.split("."); 2 == o.length && (t = t[o[0]], e = o[1]), t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } } (p = t.createElement("script")).type = "text/javascript", p.async = !0, p.src = s.api_host.replace(".i.posthog.com", "-assets.i.posthog.com") + "/static/array.js", (r = t.getElementsByTagName("script")[0]).parentNode.insertBefore(p, r); var u = e; for (void 0 !== a ? u = e[a] = [] : a = "posthog", u.people = u.people || [], u.toString = function (t) { var e = "posthog"; return "posthog" !== a && (e += "." + a), t || (e += " (stub)"), e }, u.people.toString = function () { return u.toString(1) + ".people (stub)" }, o = "capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "), n = 0; n < o.length; n++)g(u, o[n]); e._i.push([i, s, a]) }, e.__SV = 1) }(document, window.posthog || []);
        posthog.init('phc_tijPWaicFtBjDUcd4W6dRry7lSls4WUvj0tIBauVnQV', { api_host: 'https://us.i.posthog.com', persistence: 'memory' })
    </script>

</head>

<body>

    <aside class="columns announcement-banner">
        <div class="column container is-hidden-touch">
            <a href="https://www.akamai.com/newsroom/press-release/akamai-announces-acquisition-of-function-as-a-service-company-fermyon" class="plausible-event-name=menu-announcement">
                <span>
                    Announcement: Fermyon Joins Akamai&nbsp;
                    <svg width="5" height="9" viewBox="0 0 5 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.20439 0L4.55176 4.01547L0.20439 8.03095L0.20439 0Z" fill="#0E092D" />
                    </svg>
                </span>
            </a>
        </div>
        <div class="column container is-hidden-desktop">
            <a href="https://www.akamai.com/newsroom/press-release/akamai-announces-acquisition-of-function-as-a-service-company-fermyon" class="plausible-event-name=menu-announcement">
                <span>
                    Fermyon Joins Akamai&nbsp;
                    <svg width="5" height="9" viewBox="0 0 5 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.20439 0L4.55176 4.01547L0.20439 8.03095L0.20439 0Z" fill="#0E092D" />
                    </svg </span>
            </a>
        </div>
    
        <div class="stars">
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li></li>
            <li></li>
            <li class="small"></li>
            <li></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li class="small"></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li></li>
            <li class="small"></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li class="small"></li>
            <li class="small"></li>
            <li class="small"></li>
            <li class="small"></li>
            <li></li>
            <li></li>
    </aside>

    <header class="navbar is-transparent" id="topbar">
    
        <div class="navbar-burger burger is-hidden-desktop" data-target="fermyonMenu">
            <span></span>
            <span></span>
            <span></span>
        </div>
    
        <div id="fermyonMenu">

    <nav>
            <section>
                <em>01</em>
                <span class="tag">Projects</span>
                <a href="https://spinframework.dev">Spin <i><img src="/static/image/icon-external.svg" alt="external link" style="width: 0.75rem;" /></i></a>
                <a href="/wasm-functions">Wasm Functions</a>
                <a href="/cloud">Cloud</a>
                <a href="https://spinkube.dev">SpinKube <i><img src="/static/image/icon-external.svg" alt="external link" style="width: 0.75rem;" /></i></a>
                <a href="/platform">Platform</a>
            </section>
    

            <section>
                <em>02</em>
                <span class="tag">Resources</span>
                <a href="/about">About</a>
                <a href="/blog">Blog</a>
                <a href="/jobs">Careers</a>
                <a href="https://developer.fermyon.com">Docs</a>
                <a href="https://developer.fermyon.com/hub">Example Apps</a>
            </section>
    
            <section>
                <em>03</em>
                <span class="tag">Engage</span>
                <a href="/contact">Contact</a>
                <a href="/demo">Get a Demo &#187;</a>
                <a href="https://cloud.fermyon.com/login" class="is-success">Fermyon Cloud Login &#187;</a>
            </section>
        </nav>
    </div>

        <div class="navbar-wrapper">
    
            <div class="navbar-start">
                <a class="navbar-item logo-wrap" href="/#" title="Fermyon.com">
                    <div class="logo">
                        <svg width="685" height="87" viewBox="0 0 685 87" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M84.5571 18.574H16.4092V36.0591H63.5585V52.5029H16.4092V85H0V2.13016H1.86173H16.4092H84.5571V18.574Z" />
                            <path
                                d="M186.767 18.574H118.619V36.0591H165.768V52.5029H118.619V68.5128H186.767V85H118.619H104.071H102.21V2.13016H118.619H186.767V18.574Z"
                                fill="" />
                            <path
                                d="M288.89 85H263.475L234.554 60.5295H220.829V85H204.419V2.13016H259.838C265.063 2.13016 269.811 3.44625 274.083 6.07841C278.384 8.71058 281.804 12.2394 284.344 16.6649C286.913 21.0904 288.197 25.9787 288.197 31.3298C288.197 36.681 286.927 41.5693 284.387 45.9948C281.847 50.3914 278.456 53.8913 274.213 56.4945C269.97 59.0978 265.222 60.4428 259.968 60.5295L288.89 85ZM220.829 18.5306V44.1725H259.838C263.129 44.1725 265.943 42.9143 268.281 40.3978C270.619 37.8813 271.788 34.8587 271.788 31.3298C271.788 27.801 270.619 24.7928 268.281 22.3053C265.943 19.7888 263.129 18.5306 259.838 18.5306H220.829Z"
                                fill="" />
                            <path
                                d="M382.787 2H391.013V84.8698H374.604V32.9786L354.082 68.9033H343.474L322.952 32.9786V84.8698H306.543V2H314.769H324.207L348.756 45.0403L373.348 2H382.787Z"
                                fill="" />
                            <path
                                d="M492.833 2.13016L459.409 46.8191V85H443V46.5588L408.666 2.13016H429.448L451.226 30.2886L472.311 2.13016H492.833Z"
                                fill="" />
                            <path
                                d="M541.053 85C546.826 85 552.238 83.9298 557.289 81.7893C562.369 79.62 566.814 76.6407 570.624 72.8515C574.463 69.0624 577.465 64.6658 579.63 59.6618C581.823 54.6289 582.92 49.2633 582.92 43.5651C582.92 37.838 581.823 32.4724 579.63 27.4684C577.465 22.4644 574.463 18.0678 570.624 14.2786C566.814 10.4895 562.369 7.52466 557.289 5.38421C552.238 3.21485 546.826 2.13016 541.053 2.13016C535.28 2.13016 529.854 3.21485 524.774 5.38421C519.722 7.52466 515.277 10.4895 511.438 14.2786C507.628 18.0678 504.626 22.4644 502.433 27.4684C500.268 32.4724 499.186 37.838 499.186 43.5651C499.186 49.2633 500.268 54.6289 502.433 59.6618C504.626 64.6658 507.628 69.0624 511.438 72.8515C515.277 76.6407 519.722 79.62 524.774 81.7893C529.854 83.9298 535.28 85 541.053 85ZM541.053 18.6607C545.671 18.6607 549.885 19.7888 553.695 22.045C557.505 24.2722 560.536 27.2804 562.787 31.0695C565.068 34.8298 566.208 38.9949 566.208 43.5651C566.208 48.1352 565.068 52.3149 562.787 56.104C560.536 59.8643 557.505 62.8725 553.695 65.1286C549.885 67.3558 545.671 68.4694 541.053 68.4694C536.435 68.4694 532.22 67.3558 528.41 65.1286C524.6 62.8725 521.555 59.8643 519.275 56.104C517.024 52.3149 515.898 48.1352 515.898 43.5651C515.898 38.9949 517.024 34.8298 519.275 31.0695C521.555 27.2804 524.6 24.2722 528.41 22.045C532.22 19.7888 536.435 18.6607 541.053 18.6607Z"
                                fill="" />
                            <path
                                d="M668.591 2.13016H685V85H676.774H666.166L616.939 25.0821V85H600.529V2.13016H619.363L668.591 62.0481V2.13016Z"
                                fill="" />
                        </svg>
                        <span class="spin-front"><em></em></span>
                        <span class="spin-back"></span>
                    </div>
                </a>
    
                <div class="navbar-menu" aria-label="menu">
                    <div class="dropdown navbar-item is-hoverable is-hidden-touch">
                        <div class="dropdown-trigger">
                            <a href="#projects" aria-haspopup="true" class="navbar-item-hover"
                                aria-controls="dropdown-projects" aria-label="menuitem">
                                <span>Products</span>&nbsp;
                                <small class="caret">
                                    <svg width="5" viewBox="0 0 368 203" version="1.1" xmlns="http://www.w3.org/2000/svg"
                                        xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <path
                                                d="M6.16,32.63 L171.02,197.49 C174.5161,200.9861 179.2583,202.9509 184.204,202.9509 C189.1493,202.9509 193.8915,200.9861 197.388,197.49 L362.248,32.63 C365.7441,29.1339 367.7089,24.3917 367.7089,19.446 C367.7089,14.5007 365.7441,9.7585 362.248,6.262 C358.7519,2.7659 354.0097,0.8011 349.064,0.8011 L19.354,0.8011 C14.4087,0.8011 9.6665,2.7659 6.166,6.262 C2.6699,9.7581 0.7051,14.5003 0.7051,19.446 C0.7051,24.3913 2.6699,29.1335 6.166,32.63 L6.16,32.63 Z"
                                                id="Path" fill="#525776" fill-rule="nonzero"></path>
                                        </g>
                                    </svg>
                                </small>
                            </a>
                        </div>
    
                        <!-- project dropdown menu -->
                        <div id="dropdown-projects" class="navbar-dropdown mega-menu is-boxed is-active">
                            <div class="columns">
                                <!-- OSS Column -->
                                <div class="column">
                                    <p class="mega-menu-title"><span class="mono">01</span>Build Your Apps:</p>
    
                                    <div class="menu-item">
                                        <div class="menu-icon">
                                            <img src="/static/image/icon-spin.png" alt="Spin" />
                                        </div>
                                        <div class="menu-content">
                                            <a href="https://spinframework.dev" target="_blank">
                                                <h3>
                                                    Spin
                                                    <span class="tag tag-cncf">CNCF</span>
                                                </h3>
                                                <p>Developer framework and CLI for building fast Wasm apps.</p>
                                            </a>
                                        </div>
                                    </div>
                                </div>
    
                                <!-- Managed Infrastructure Column -->
                                <div class="column">
                                    <p class="mega-menu-title"><span class="mono">02A</span>Deploy to a Fermyon Service:</p>
    
                                    <div class="menu-item">
                                        <div class="menu-icon">
                                            <img src="/static/image/icon-functions.png" alt="Fermyon Wasm Functions" />
                                        </div>
                                        <div class="menu-content">
                                            <a href="/wasm-functions" class="">
                                                <h3>Wasm Functions</h3>
                                                <p>Powerful engine for edge apps and functions on Akamai Cloud.</p>
                                            </a>
                                        </div>
                                    </div>
    
                                    <div class="menu-item">
                                        <div class="menu-icon">
                                            <img src="/static/image/icon-cloud.png" alt="Fermyon Cloud" />
                                        </div>
                                        <div class="menu-content">
                                            <a href="/cloud" class="">
                                                <h3>Cloud</h3>
                                                <p>Deploy your Spin apps to Fermyon's serverless cloud.</p>
                                            </a>
                                        </div>
                                    </div>
                                </div>
    
                                <!-- Open Source Column -->
                                <div class="column">
                                    <p class="mega-menu-title"><span class="mono">02B</span> Deploy to Your Kubernetes:</p>
    
                                    <div class="menu-item">
                                        <div class="menu-icon">
                                            <img src="/static/image/icon-spinkube.png" alt="SpinKube" />
                                        </div>
                                        <div class="menu-content">
                                            <a class="" href="https://www.spinkube.dev/" target="_blank">
                                                <h3>
                                                    SpinKube
                                                    <span class="tag tag-cncf">CNCF</span>
                                                </h3>
                                                <p>Develop and operate Spin apps in your Kubernetes cliuster.</p>
                                            </a>
                                        </div>
                                    </div>
    
                                    <div class="menu-item">
                                        <div class="menu-icon">
                                            <img src="/static/image/icon-fp4k.png" alt="Fermyon Platform for Kubernetes" />
                                        </div>
                                        <div class="menu-content">
                                            <a href="platform" target="_blank" class="external">
                                                <h3>Platform for Kubernetes</h3>
                                                <p>Solution for large-scale, high performance enterprise clusters.</p>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /list of projects -->
    
                    <div class="dropdown navbar-item is-hoverable is-hidden-touch">
                        <div class="dropdown-trigger">
                            <a href="https://developer.fermyon.com/" aria-haspopup="true" class="navbar-item-hover"
                                aria-controls="dropdown-developer" aria-label="menuitem">
                                <span>Developer</span>&nbsp;
                                <small class="caret">
                                    <svg width="5" viewBox="0 0 368 203" version="1.1" xmlns="http://www.w3.org/2000/svg"
                                        xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                            <path
                                                d="M6.16,32.63 L171.02,197.49 C174.5161,200.9861 179.2583,202.9509 184.204,202.9509 C189.1493,202.9509 193.8915,200.9861 197.388,197.49 L362.248,32.63 C365.7441,29.1339 367.7089,24.3917 367.7089,19.446 C367.7089,14.5007 365.7441,9.7585 362.248,6.262 C358.7519,2.7659 354.0097,0.8011 349.064,0.8011 L19.354,0.8011 C14.4087,0.8011 9.6665,2.7659 6.166,6.262 C2.6699,9.7581 0.7051,14.5003 0.7051,19.446 C0.7051,24.3913 2.6699,29.1335 6.166,32.63 L6.16,32.63 Z"
                                                id="Path" fill="#525776" fill-rule="nonzero"></path>
                                        </g>
                                    </svg>
                                </small>
                            </a>
                        </div>
    
                        <div id="dropdown-developer" class="navbar-dropdown is-boxed">
                            <a class="dropdown-item" href="https://spinframework.dev/quickstart"
                                title="Developer Docs">Documentation</a>
                            <a class="dropdown-item" href="https://developer.fermyon.com/hub/"
                                title="Spin Up Hub: Examples and Templates">Examples &amp; Templates</a>
    
                            <a class="dropdown-item"
                                href="https://developer.fermyon.com/wasm-languages/webassembly-language-support"
                                title="See support for compiling languages to WebAssembly">Supported Languages</a>
                            <hr class="divider">
                            <a class="dropdown-item" href="/discord"
                                title="github.com/fermyon">Discord</a>
                            <a class="dropdown-item" href="https://github.com/fermyon/"
                                title="github.com/fermyon">GitHub</a>
                        </div>
                    </div>
    
                    <div class="dropdown navbar-item is-hoverable is-hidden-touch">
                        <div class="dropdown-trigger">
                            <a class="navbar-item navbar-item-hover" href="/blog/index"
                                title="Read the latest articles from Fermyon Technologies"><span>Blog</span></a>
                        </div>
                    </div>
    
                </div>
            </div>
    
            <div class="navbar-end">
    
                <section class="navbar-ctas navbar-ctas-secondary is-hidden-touch">
                    <a class="navbar-item plausible-event-name=menu-contact-sales" href="/demo" target="_blank"
                        aria-label="menuitem" title="Connect with our team">Contact Sales</a>
    
                    <a class="navbar-item plausible-event-name=menu-cloud-login" href="https://cloud.fermyon.com/login"
                        target="_blank" aria-label="menuitem" title="Fermyon Cloud Login &#8250;">Cloud Login</a>
                </section>
    
                <section class="navbar-ctas navbar-ctas-primary is-hidden-touch">
    
                    <a class="dark-mode navbar-item plausible-event-name=menu-toggle-light">
                        <svg width="1.125rem" height="1.125rem" viewBox="0 0 502 502" version="1.1"
                            xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                            <title>Toggle light/dark mode</title>
                            <g id="Page-1" stroke="none" stroke-width="1" fill-rule="evenodd">
                                <g id="dark-mode" transform="translate(0.168000, 0.168250)" fill-rule="nonzero">
                                    <g id="Group">
                                        <path
                                            d="M385.003107,250.83175 C385.099656,207.97975 364.717,167.66375 330.15,142.34175 C295.58,117.02175 250.994,109.74375 210.17,122.75975 C169.342,135.77975 137.197,167.52175 123.666,208.18175 C123.32616,208.93956 123.02928,209.72085 122.77928,210.51375 C114.53708,236.71275 114.53708,264.81475 122.77928,291.01375 C123.02928,291.81062 123.32616,292.58795 123.666,293.34575 C137.193,333.99075 169.318,365.72475 210.123,378.75175 C250.928,391.77875 295.502,384.52905 330.073,359.23975 C364.647,333.95075 385.057,293.66575 385.003107,250.82975 L385.003107,250.83175 Z M151.672,250.83175 L151.668093,250.83175 C151.7345,244.95675 152.328253,239.10175 153.441493,233.33175 L233.336493,233.33175 L233.336493,268.33175 L153.441493,268.33175 C152.328193,262.56225 151.734493,256.70675 151.668093,250.83175 L151.672,250.83175 Z M233.34,153.43675 L233.336094,198.33175 L167.047094,198.33175 C181.836094,174.69875 205.902094,158.39775 233.336094,153.43675 L233.34,153.43675 Z M167.047,303.32675 L233.336,303.32675 L233.336,348.22175 C205.902,343.26085 181.836,326.95975 167.047,303.32675 Z M268.337,348.22175 L268.337,153.43175 C299.095,158.88095 325.474,178.54075 339.482,206.45875 C353.494,234.37675 353.494,267.27475 339.482,295.19275 C325.474,323.11075 299.095,342.77075 268.337,348.21975 L268.337,348.22175 Z"
                                            id="Shape"></path>
                                        <path
                                            d="M268.332,64.16375 L268.332,17.49975 C268.332,11.24585 264.9961,5.46875 259.582,2.34375 C254.1679,-0.78125 247.496,-0.78125 242.082,2.34375 C236.668,5.46875 233.332,11.24605 233.332,17.49975 L233.332,64.16375 C233.332,70.41765 236.6679,76.19475 242.082,79.31975 C247.4961,82.44475 254.168,82.44475 259.582,79.31975 C264.996,76.19475 268.332,70.41745 268.332,64.16375 Z"
                                            id="Path"></path>
                                        <path
                                            d="M428.162,73.50175 C424.8808,70.21655 420.4276,68.36895 415.783,68.36895 C411.1424,68.36895 406.6892,70.21665 403.408,73.50175 L370.459,106.47075 C366.0371,110.89265 364.3106,117.33775 365.9278,123.38075 C367.5489,129.41985 372.2676,134.13875 378.3068,135.75975 C384.3498,137.37695 390.7948,135.65037 395.2168,131.22855 L428.1618,98.20855 C431.4313,94.93125 433.2712,90.48585 433.2712,85.85655 C433.2712,81.22375 431.4314,76.77845 428.1618,73.50155 L428.162,73.50175 Z"
                                            id="Path"></path>
                                        <path
                                            d="M484.162,233.33175 L437.498,233.33175 C431.2441,233.33175 425.467,236.66765 422.342,242.08175 C419.217,247.49585 419.217,254.16775 422.342,259.58175 C425.467,264.99575 431.2443,268.33175 437.498,268.33175 L484.166,268.33175 L484.162093,268.33175 C490.415993,268.33175 496.193093,264.99585 499.318093,259.58175 C502.443093,254.16765 502.443093,247.49575 499.318093,242.08175 C496.193093,236.66775 490.415793,233.33175 484.162093,233.33175 L484.162,233.33175 Z"
                                            id="Path"></path>
                                        <path
                                            d="M403.452,428.16175 C407.9364,432.17345 414.175,433.59925 419.956,431.93125 C425.7412,430.26715 430.265,425.74375 431.929,419.95825 C433.597,414.17705 432.17119,407.93825 428.1595,403.45425 L395.1675,370.43825 L395.1675,370.434344 C390.7456,366.012444 384.3005,364.285944 378.2575,365.903144 C372.2184,367.524244 367.4995,372.242944 365.8785,378.282144 C364.2613,384.325144 365.98788,390.770144 370.4097,395.192144 L403.452,428.16175 Z"
                                            id="Path"></path>
                                        <path
                                            d="M233.332,437.50175 L233.332,484.16975 L233.332,484.165843 C233.332,490.419743 236.6679,496.196843 242.082,499.321843 C247.4961,502.446843 254.168,502.446843 259.582,499.321843 C264.996,496.196843 268.332,490.419543 268.332,484.165843 L268.332,437.501843 C268.332,431.247943 264.9961,425.470843 259.582,422.345843 C254.1679,419.220843 247.496,419.220843 242.082,422.345843 C236.668,425.470843 233.332,431.248143 233.332,437.501843 L233.332,437.50175 Z"
                                            id="Path"></path>
                                        <path
                                            d="M73.502,428.16175 C76.7872,431.43515 81.2403,433.27505 85.881,433.27505 C90.5177,433.27505 94.9708,431.43525 98.256,428.16175 L131.248,395.14575 L131.251907,395.14575 C135.544907,390.70435 137.177707,384.32575 135.548807,378.36475 C133.916007,372.40385 129.263607,367.74375 123.302807,366.10675 C117.345807,364.47005 110.962807,366.098937 106.517807,370.38795 L73.501807,403.45395 C70.232307,406.73125 68.392407,411.17665 68.392407,415.80595 C68.392407,420.43875 70.232207,424.88405 73.501807,428.16095 L73.502,428.16175 Z"
                                            id="Path"></path>
                                        <path
                                            d="M0,250.83175 C0,255.47235 1.8438,259.92555 5.125,263.20675 C8.4062,266.48795 12.8555,268.33175 17.5,268.33175 L64.164,268.33175 C70.4179,268.33175 76.195,264.99585 79.32,259.58175 C82.445,254.16765 82.445,247.49575 79.32,242.08175 C76.195,236.66775 70.4177,233.33175 64.164,233.33175 L17.5,233.33175 C12.8555,233.33175 8.4062,235.17555 5.125,238.45675 C1.8438,241.73795 0,246.19115 0,250.83175 Z"
                                            id="Path"></path>
                                        <path
                                            d="M131.202,131.22175 C134.4872,127.93655 136.3309,123.48735 136.3309,118.84275 C136.3309,114.19815 134.4871,109.74505 131.202,106.46375 L98.206,73.49475 C93.7216,69.48305 87.483,68.05725 81.702,69.72525 C75.9168,71.38935 71.393,75.91275 69.729,81.69825 C68.061,87.47945 69.48681,93.71825 73.4985,98.20225 L106.4675,131.22225 C109.7527,134.49175 114.198,136.32775 118.8345,136.32775 C123.4712,136.32775 127.9165,134.49185 131.2015,131.22225 L131.202,131.22175 Z"
                                            id="Path"></path>
                                    </g>
                                </g>
                            </g>
                        </svg>
                    </a>
    
                    <!-- conditionally show the button CTAs -->



                    <a class="navbar-item button is-secondary is-rounded is-medium plausible-event-name=cta-schedule-demo"
                        href="/demo" aria-label="menuitem" title="Connect with our team">
                        Get a Demo</a>
                        <a class="navbar-item button is-primary is-rounded is-medium plausible-event-name=cta-functions-request"
                        href="/wasm-functions" aria-label="menuitem"
                        title="Request Access to the Fermyon Wasm Functions service">
                        Explore Wasm Functions
                        </a>
            </section>
    
            </div>
        </div>
    </header>
    <main>
<div class="page-wrap container">
    <div class="columns is-flex-wrap-wrap is-centered">
        
        <div class="column blog-column">
            <article class="blog blog-post content">

                <nav>
                    <a class="blog-back" href="/blog/index">
                        <img src="/static/image/arrow-green.svg" alt="Back to Blog index">
                        <span>Back</span>
                    </a>
                </nav>

                <div class="blog-meta">

                    <div class="field is-grouped is-grouped-multiline is-flex">
                        <div class="control is-flex">
                            <div class="tags has-addons">
                                <span class="tag is-rounded"><a href="/blog/index">Blog</a></span>
                                <span class="tag is-rounded"><a
                                        href="/category?tag=community">community</a></span>
                            </div>

                            <span class="date is-flex">March 13, 2025</span>
                        </div>
                    </div>

                    <h1 class="title">Looking Ahead to WASIp3</h1>

                    <div class="blog-meta-avatar">
                            <img class="is-rounded is-centered" src="/static/image/avatar.png">

                        <span class="blog-meta-author">
                            Joel Dice
                        </span>

                        <p class="blog-meta-tags">
                            <span class="tags">
                                <span class="tag is-light is-rounded">wasi</span>
                                <span class="tag is-light is-rounded">wasm</span>
                                <span class="tag is-light is-rounded">webassembly</span>
                            </span>
                        </p>
                    </div>

                    <span class="image-wrap">
                        <img class="blog-thumb" src="/static/image/twc-wasip3.jpg"
                            alt="Looking Ahead to WASIp3" />
 
                    </span>
                </div>

                <h1></h1>
                <p>WebAssembly System Interface Preview 3 (or WASIp3 for short) is the next major
release of WASI, a set of standards-track APIs for portable application
development with WebAssembly. This release will include significant
improvements to the underlying Component Model ‚Äì including support for first
class, composable concurrency ‚Äì while maintaining compatibility with the
existing WASIp2 release.</p>
<p>In this post, we‚Äôll summarize the new features coming with WASIp3, look at the
status of the implementation efforts, and finally build a real-world example
which puts those new features to use.</p>
<!-- break -->
<h2>About WASI and the WebAssembly Component Model</h2>
<p><a href="https://wasi.dev/">WASI (WebAssembly System Interface)</a> is a set of interfaces
covering both traditional operating system features (e.g. file I/O, clocks, and
networking) as well as more specialized features such as cloud services (HTTP,
database access, messaging, etc.), abstractions for embedded systems,
cryptography, etc.</p>
<p>So far, WASI has had two milestone releases: 0.1 (AKA WASIp1, ‚ÄúPreview 1‚Äù) and
0.2 (AKA WASIp2, ‚ÄúPreview 2‚Äù). The latter was released early last year and was
built upon the <a href="https://component-model.bytecodealliance.org/">Component Model</a>,
a proposed standard for expressing the high-level interface of a Wasm
application or library, enabling cross-language code reuse and secure dependency
isolation.</p>
<p>Before WASIp2 was even released, a few of us in the Bytecode Alliance were
already prototyping the foundations of WASIp3, and we‚Äôve made a lot of progress
since then. Although there‚Äôs still significant work to do before it‚Äôs finally
released later this year, we expect to start making release candidate snapshots
available in the next couple of months, with experimental support for those
snapshots landing in <a href="https://github.com/spinframework/spin">Spin</a> and other
popular runtimes soon after. These runtimes use WASI to provide a standardized
environment for WebAssembly modules to interact with the host system.</p>
<h2>New Features in WASIp3</h2>
<p>The main theme of WASIp3 is <em>composable</em> <em>concurrency</em>. Earlier releases
support asynchronous I/O via a <code>poll</code> function which accepts a set of handles
representing in-progress tasks, blocking until at least one of them completes.
That works great for many purposes, but it makes composing components
impractical when more than one of them need to do I/O concurrently; only one can
call <code>poll</code> at a time, during which none of the others can make progress.</p>
<p>In contrast, WASIp3 is based on two important new Component Model features:</p>
<ul>
<li>An asynchronous function ABI: This allows components to export and/or import
functions using either the existing synchronous ABI or the new asynchronous
ABI. Additionally, it avoids <a href="https://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/">the function coloring
problem</a>
by seamlessly connecting async imports to sync-exported functions and vice
versa.</li>
<li>Support for built-in, generic <code>stream</code> and <code>future</code> types, providing
efficient, optionally asynchronous, cross-component and component&lt;-&gt;host
communication.</li>
</ul>
<p>Together, these features make concurrency a first-class concept in the component
model, allowing arbitrary numbers of guest tasks to run concurrently in the same
component instance. Moreover, components using the new async ABI may be
composed with other components without risk of being blocked when one of those
components makes a synchronous call. In that case, the host runtime will notice
the blocking call, suspend the task that made it, and allow the original
component to continue executing.</p>
<p>Thanks to those new features, the WebAssembly Interface Types (WIT) definitions
for 0.3 have been significantly simplified compared to their 0.2 counterparts.
For example, while
<a href="https://github.com/WebAssembly/wasi-http/blob/main/wit/types.wit"><code>wasi:http@0.2.4</code></a>
includes 11 distinct resource types,
<a href="https://github.com/WebAssembly/wasi-http/blob/main/wit-0.3.0-draft/types.wit"><code>wasi:http@0.3.0-draft</code></a>
needs only 5. Similarly, the ceremony required to perform an asynchronous
operation with WASIp2 ‚Äì creating a <code>pollable</code>, adding it to a list along with
anything else you intend to wait for, calling <code>poll</code>, and dispatching events
according to which <code>pollable</code>s are ready ‚Äì has been replaced with a single call
to an <code>async</code> function in your programming language of choice.</p>
<h2>WASIp3 Status</h2>
<p>The <a href="https://github.com/WebAssembly/component-model">Component Model
Specification</a> includes a
complete description of the async ABI, streams, futures, and associated built-in
functions (look for the üîÄ icon). Note that the spec is still being refined as
we gain more implementation experience, but we don‚Äôt expect any major changes
between now and the WASIp3 release.</p>
<p>Draft 0.3 interfaces have been written for each of the main WASI projects:</p>
<ul>
<li><a href="https://github.com/WebAssembly/wasi-clocks/tree/main/wit-0.3.0-draft">wasi-clocks</a></li>
<li><a href="https://github.com/WebAssembly/wasi-random/tree/main/wit-0.3.0-draft">wasi-random</a></li>
<li><a href="https://github.com/WebAssembly/wasi-filesystem/tree/main/wit-0.3.0-draft">wasi-filesystem</a></li>
<li><a href="https://github.com/WebAssembly/wasi-sockets/tree/main/wit-0.3.0-draft">wasi-sockets</a></li>
<li><a href="https://github.com/WebAssembly/wasi-cli/tree/main/wit-0.3.0-draft">wasi-cli</a></li>
<li><a href="https://github.com/WebAssembly/wasi-http/tree/main/wit-0.3.0-draft">wasi-http</a></li>
</ul>
<p>Implementation-wise, the latest
<a href="https://github.com/bytecodealliance/wasm-tools/"><code>wasm-tools</code></a> release includes
full support for parsing, emitting, printing, etc. components using the new
async features. Likewise, the latest
<a href="https://github.com/bytecodealliance/wit-bindgen"><code>wit-bindgen</code></a> release
supports generating idiomatic Rust bindings that use those features, with
support for other languages on the way.</p>
<p>Host runtime support for the new Component Model features and WASIp3 is being
developed in <a href="https://github.com/bytecodealliance/wasip3-prototyping">the <code>wasip3-prototyping</code>
repo</a> for Wasmtime and
in <a href="https://github.com/bytecodealliance/jco/pull/585">the <code>jco</code></a> repo.</p>
<h2><code>wasi-http</code> Middleware Example</h2>
<p>Let‚Äôs see what it‚Äôs like to use WASIp3 by writing a simple <code>wasi:http</code> request
handler in Rust, then composing it with a middleware component which
transparently compresses the response body.</p>
<p>First, we‚Äôll install a few tools to help us build and run the components. Given
that the WASIp3 implementation work is still ongoing as of this writing, we‚Äôll
use specific versions of these tools which are known to work together. Later
versions might work, but might use an incompatible snapshot of the
specification.</p>
<p>üöß Note that, since p3 is a work-in-progress, much of the usual tooling and
ergonomic affordances are not yet in place. That means there‚Äôs currently extra
work and boilerplate needed to build WASIp3 components compared to WASIp2. In
this example, we‚Äôll use the üöß icon to point out the extra scaffolding which
will become unecessary as we get closer to a release.</p>
<p>The following commands assume a Unix-style shell (e.g. Linux, MacOS, or WSL2)
with <code>curl</code> and <code>git</code> installed. These commands will install Rust,
<code>wasm-tools</code>, a temporary fork of Spin with <code>wasi:http@0.3.0-draft</code> support, a
copy of the corresponding WIT files we‚Äôll use to generate bindings, and an
adapter module we‚Äôll use when generating the components.</p>
<p>üöß Most of these steps will be unnecessary once <code>wasm32-wasip3</code> is an offical
Rust target platform and <a href="https://docs.rs/wasi">the <code>wasi</code> crate</a> supports it. üöß</p>
<pre><code class="language-shell">mkdir wasip3-http &amp;&amp; cd wasip3-http
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
rustup target install wasm32-wasip1
cargo install --locked --version 1.227.1 wasm-tools
cargo install --locked --git https://github.com/dicej/spin --branch wasi-http-p3-demo spin-cli
git clone https://github.com/WebAssembly/wasi-http -n &amp;&amp; pushd wasi-http &amp;&amp; git checkout 505ebdb9 &amp;&amp; popd
curl -OL https://github.com/bytecodealliance/wasmtime/releases/download/v30.0.2/wasi_snapshot_preview1.reactor.wasm
</code></pre>
<p>Let‚Äôs check we have all we need:</p>
<pre><code class="language-shell">$ spin -V
spin 3.2.0-pre0 (6d7f2983 2025-03-12)

$ wasm-tools --version
wasm-tools 1.227.1

$ ls
wasi-http                               wasi_snapshot_preview1.reactor.wasm

$ rustup target list --installed
...
wasm32-wasip1
...
</code></pre>
<p>Next, we‚Äôll write a ‚Äúhello, world‚Äù <code>wasi:http</code> request handler, creating three
files in the directory <code>wasip3-http</code>:</p>
<ul>
<li><code>spin.toml</code>: the manifest file describing our Spin application:</li>
</ul>
<pre><code class="language-toml">spin_manifest_version = 2

application.name = &quot;hello&quot;

[[trigger.http]]
route = &quot;/...&quot;
component = &quot;hello&quot;

[component.hello]
source = &quot;hello.wasm&quot;
# üöß The `wasm-tools component new` command will be unnecessary once Rust has
# proper `wasm32-wasip3` support. üöß
build.command = &quot;&quot;&quot;
cargo build --manifest-path hello/Cargo.toml --release --target wasm32-wasip1 \
  &amp;&amp; wasm-tools component new --skip-validation \
       hello/target/wasm32-wasip1/release/hello.wasm \
       -o hello.wasm --adapt wasi_snapshot_preview1.reactor.wasm
&quot;&quot;&quot;
</code></pre>
<ul>
<li><code>hello/Cargo.toml</code>: the project and dependency configuration file for our Rust project:</li>
</ul>
<pre><code class="language-toml">[package]
name = &quot;hello&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies.wit-bindgen]
git = &quot;https://github.com/bytecodealliance/wit-bindgen&quot;
rev = &quot;d73c073b&quot;

[dependencies.wit-bindgen-rt]
git = &quot;https://github.com/bytecodealliance/wit-bindgen&quot;
rev = &quot;d73c073b&quot;
</code></pre>
<ul>
<li><code>hello/src/lib.rs</code>: the source code for our component:</li>
</ul>
<pre><code class="language-rust">// üöß Once the `wasi` crate supports WASIp3, we'll be able to use its
// pre-generated bindings rather then generate them on-the-fly with
// `wit-bindgen` as we do here: üöß
wit_bindgen::generate!({
    path: &quot;../wasi-http/wit-0.3.0-draft&quot;,
    world: &quot;wasi:http/proxy&quot;,
    async: {
        exports: [
            &quot;wasi:http/handler@0.3.0-draft#handle&quot;,
        ]
    },
    generate_all,
});

use {
    wasi::http::types::{Body, ErrorCode, Headers, Request, Response},
    wit_bindgen_rt::async_support::{self, futures::SinkExt},
};

struct Component;
export!(Component);

impl exports::wasi::http::handler::Guest for Component {
    async fn handle(_request: Request) -&gt; Result&lt;Response, ErrorCode&gt; {
        let (mut tx, rx) = wit_stream::new();

        async_support::spawn(async move {
            _ = tx.send(b&quot;Hello, WASIp3!&quot;.into()).await;
        });

        Ok(Response::new(Headers::new(), Some(Body::new(rx).0)))
    }
}
</code></pre>
<p>You should now see the following files and directories in <code>wasip3-http</code>:</p>
<pre><code class="language-shell">- hello
- spin.toml
- wasi-http
- wasi_snapshot_preview1.reactor.wasm
</code></pre>
<p>Now we can build that and run it:</p>
<pre><code class="language-shell">spin build -u
</code></pre>
<p>Then, in another terminal, we can send a request:</p>
<pre><code class="language-shell">curl -i localhost:3000
</code></pre>
<p>If all went well, we should see something like:</p>
<pre><code class="language-text">HTTP/1.1 200 OK
transfer-encoding: chunked
date: Tue, 11 Mar 2025 16:38:58 GMT

Hello, WASIp3!
</code></pre>
<p>Next, we‚Äôll write another component which we can compose with the first to add
support for compressing the response body. We‚Äôll create two new files:</p>
<ul>
<li><code>middleware/Cargo.toml</code>: the project and dependency configuration file for our Rust project:</li>
</ul>
<pre><code class="language-toml">[package]
name = &quot;middleware&quot;
version = &quot;0.1.0&quot;
edition = &quot;2021&quot;

[lib]
crate-type = [&quot;cdylib&quot;]

[dependencies.wit-bindgen]
git = &quot;https://github.com/bytecodealliance/wit-bindgen&quot;
rev = &quot;d73c073b&quot;

[dependencies.wit-bindgen-rt]
git = &quot;https://github.com/bytecodealliance/wit-bindgen&quot;
rev = &quot;d73c073b&quot;

[dependencies.flate2]
version = &quot;1.0.28&quot;
</code></pre>
<ul>
<li><code>middleware/src/lib.rs</code>: the source code for our component:</li>
</ul>
<pre><code class="language-rust">// üöß Once the `wasi` crate supports WASIp3, we'll be able to use its
// pre-generated bindings rather then generate them on-the-fly with
// `wit-bindgen` as we do here: üöß
wit_bindgen::generate!({
    path: &quot;../wasi-http/wit-0.3.0-draft&quot;,
    world: &quot;wasi:http/proxy&quot;,
    async: {
        imports: [
            &quot;wasi:http/handler@0.3.0-draft#handle&quot;,
        ],
        exports: [
            &quot;wasi:http/handler@0.3.0-draft#handle&quot;,
        ]
    },
    generate_all,
});

use {
    flate2::{write::DeflateEncoder, Compression},
    std::{io::Write, mem},
    wasi::http::{
        handler,
        types::{Body, ErrorCode, Headers, Request, Response},
    },
    wit_bindgen_rt::async_support::{
        self,
        futures::{SinkExt, StreamExt},
    },
};

struct Component;
export!(Component);

impl exports::wasi::http::handler::Guest for Component {
    /// Forward the specified request to the imported `wasi:http/handler`,
    /// encoding the response body if the client has provided an
    /// `accept-encoding: deflate` header.
    async fn handle(request: Request) -&gt; Result&lt;Response, ErrorCode&gt; {
        // üöß Since we're using the auto-generated bindings directly, the code
        // below is a bit verbose.  We expect crates like
        // [wstd](https://docs.rs/wstd) will provide types, traits, and
        // functions to help make code like this more concise. üöß

        // First, extract the parts of the request and check for (and remove)
        // the `accept-encoding` header.

        let method = request.method();
        let scheme = request.scheme();
        let authority = request.authority();
        let path_with_query = request.path_with_query();
        let (headers, body) = Request::into_parts(request);
        let mut headers = headers.entries();

        let mut accept_deflated = false;
        headers.retain(|(key, value)| {
            if &quot;accept-encoding&quot; == key.as_str() {
                accept_deflated |= std::str::from_utf8(&amp;value)
                    .map(|v| v.contains(&quot;deflate&quot;))
                    .unwrap_or(false);
                false
            } else {
                true
            }
        });

        // Synthesize a request from the parts collected above and pass it to
        // the imported `wasi:http/handler`.

        let inner_request = Request::new(
            Headers::from_list(&amp;headers).unwrap(),
            body,
            None
        );
        inner_request.set_method(&amp;method).unwrap();
        inner_request.set_scheme(scheme.as_ref()).unwrap();
        inner_request
            .set_path_with_query(path_with_query.as_deref())
            .unwrap();
        inner_request.set_authority(authority.as_deref()).unwrap();

        let response = handler::handle(inner_request).await?;

        // Now that we have the response, extract the parts and optionally
        // compress the body if applicable.

        let status_code = response.status_code();
        let (headers, body) = Response::into_parts(response);
        let mut headers = headers.entries();
        let body = if accept_deflated {
            if let Some(body) = body {
                // Remove the `content-length` header, if any, since we'll be
                // using chunked encoding instead.
                headers.retain(|(name, _value)| name != &quot;content-length&quot;);
                // Add a header to indicate the encoding.
                headers.push((&quot;content-encoding&quot;.into(), b&quot;deflate&quot;.into()));

                // Spawn a task to pipe and encode the original response body and
                // trailers into a new response we'll create below.  This will run
                // concurrently with the caller's code (i.e. it won't necessarily
                // complete before we return a value).

                let (mut pipe_tx, pipe_rx) = wit_stream::new();

                async_support::spawn(async move {
                    let mut body_rx = body.stream().unwrap().0;
                    let mut encoder = DeflateEncoder::new(
                        Vec::new(),
                        Compression::fast()
                    );
                    while let Some(Ok(chunk)) = body_rx.next().await {
                        encoder.write_all(&amp;chunk).unwrap();
                        pipe_tx.send(mem::take(encoder.get_mut())).await.unwrap();
                    }
                    pipe_tx.send(encoder.finish().unwrap()).await.unwrap();
                });

                Some(Body::new(pipe_rx).0)
            } else {
                None
            }
        } else {
            body
        };

        // While the above task (if any) is running, synthesize a response from
        // the parts collected above and return it.

        let response = Response::new(Headers::from_list(&amp;headers).unwrap(), body);
        response.set_status_code(status_code).unwrap();

        Ok(response)
    }
}
</code></pre>
<p>And then we‚Äôll edit the <code>spin.toml</code> file we created earlier to build our new
component and compose it with the original one:</p>
<pre><code class="language-toml">spin_manifest_version = 2

application.name = &quot;hello&quot;

[[trigger.http]]
route = &quot;/...&quot;
component = &quot;hello&quot;

[component.hello]
source = &quot;composed.wasm&quot;
# üöß The `wasm-tools component new` commands will be unnecessary once Rust has
# proper `wasm32-wasip3` support. üöß
build.command = &quot;&quot;&quot;
cargo build --manifest-path hello/Cargo.toml \
       --release --target wasm32-wasip1 \
  &amp;&amp; wasm-tools component new --skip-validation \
       hello/target/wasm32-wasip1/release/hello.wasm \
       -o hello.wasm --adapt wasi_snapshot_preview1.reactor.wasm \
  &amp;&amp; cargo build --manifest-path middleware/Cargo.toml \
       --release --target wasm32-wasip1 \
  &amp;&amp; wasm-tools component new --skip-validation \
       middleware/target/wasm32-wasip1/release/middleware.wasm \
       -o middleware.wasm --adapt wasi_snapshot_preview1.reactor.wasm \
  &amp;&amp; wasm-tools compose --skip-validation middleware.wasm -d hello.wasm \
       -o composed.wasm
&quot;&quot;&quot;
</code></pre>
<p>Now we can build and run the composition:</p>
<pre><code class="language-shell">spin build -u
</code></pre>
<p>Then, in another terminal, we can send a request:</p>
<pre><code class="language-shell">curl --compressed -i localhost:3000
</code></pre>
<p>If all went well, we should see something like:</p>
<pre><code class="language-text">HTTP/1.1 200 OK
content-encoding: deflate
transfer-encoding: chunked
date: Tue, 11 Mar 2025 16:52:13 GMT

Hello, WASIp3!
</code></pre>
<p>Note that, while we used Rust to write both of the above components, we could
just as easily have written one of them in Python and the other in JavaScript ‚Äì
the Component Model enables language-agnostic code reuse, so you can use the
best tool for each job and easily reuse third-party components regardless of
their implementation language.</p>
<p>In addition, although we‚Äôve used the <code>wasi:http</code> WIT files to define the
interface between the components we built, we could have just as easily written
our own custom, domain-specific WIT file and used that instead. In that case,
we‚Äôd have all the same Component Model features at our disposal:</p>
<ul>
<li>A rich type system supporting custom <code>record</code>, <code>variant</code>, and <code>resource</code> types, etc.</li>
<li><code>future</code>s and <code>stream</code>s (with arbitrary payload types) representing deferred computation and I/O</li>
<li>Optionally asynchronous imports and exports</li>
<li>Cross-language composition</li>
<li>Secure sandboxing</li>
</ul>
<p>If you‚Äôd like to remove the custom builds of Spin and wasm-tools we installed earlier, run the following commands:</p>
<pre><code class="language-shell">$ cargo uninstall wasm-tools

$ cargo uninstall spin
</code></pre>
<h2>Next Steps</h2>
<p>Although WASIp3 has not yet been released, and the implementations are not yet
ready for production use, now is a great time to experiment with it and provide
feedback by opening issues on either the <a href="https://github.com/WebAssembly/component-model">spec
repo</a> or the <a href="https://github.com/bytecodealliance/wasip3-prototyping">wasip3-prototyping
repo</a>. Whether you‚Äôre
developing Wasm components or custom host embeddings to run components, we‚Äôd
love to have your input. And if you‚Äôre a language implementer looking to add
concurrency support for Wasm targets, we‚Äôd appreciate your input as well.</p>
<p>Finally, if you‚Äôre interested in helping us finish and ship WASIp3, don‚Äôt
hesitate to reach out on <a href="https://bytecodealliance.zulipchat.com/#narrow/channel/219900-wasi">the WASI Zulip
channel</a>,
and check out <a href="https://github.com/orgs/bytecodealliance/projects/16">the project
board</a> to see what work
remains to do.</p>
<h2>Acknowledgements</h2>
<p>The design and implementation of WASIp3 has been a collaborative effort from the
beginning. Here are a few of the more notable contributors:</p>
<ul>
<li>Luke Wagner @Fastly (design, specification, and Python reference implementation)</li>
<li>Bailey Hayes, Roman Volosatovs, and Victor Adossi @Cosmonic (WIT updates, WASIp3 host implementation, Jco implementation, stream/future error handling)</li>
<li>Tomasz Andrzejak and Yoshua Wuyts @Microsoft (Jco implementation, Cat herding)</li>
<li>Calvin Prewitt @JAF Labs (Jco implementation)</li>
<li>Alex Crichton and Joel Dice @Fermyon (wasm-tools, wit-bindgen, and Wasmtime implementations)</li>
</ul>
  
            </article>

            <!-- embed Spin Up Hub examples in a blog post
                 or page with this template -->
            <div class="columns is-multiline is-mobile is-0 card-example-list" id="hub-examples">
            
                <div class="column is-full card-list">
            




        
                    <p>&nbsp;</p>
                </div>
            </div>
        </div>

        <div class="blog blog-post blog-listing content">
            <hr>

            <div class="column"> <!-- static contents -->
                <div class="blog-rec-wrapper">
                    <h2>üî• Recommended Posts</h2>
                    <br>
                    <div class="columns is-variable is-8 is-flex-wrap-wrap">
                        <article class="column is-one-third-desktop is-half-tablet is-full-mobile blog-featured">
                
                            <a href="/blog/introducing-wasm-functions" title="Introducing Fermyon Wasm Functions on Akamai"
                                class="blog-link">
                                <span class="image-wrap">
                                    <img class="blog-thumb" src="/static/image/twc-fermyon-wasm-functions-on-akamai.jpg"
                                        alt="Introducing Fermyon Wasm Functions on Akamai">
                                </span>
                
                                <h1 class="title">
                                   Introducing Fermyon Wasm Functions on Akamai
                                </h1>
                            </a>
                            <section class="blog-summary">
                                <div class="truncate">
                                    <p>This new globally hosted and managed service runs within the Akamai Cloud and delivers absolutely mind-boggling performance...</p>
                                    <span class="fade"></span>
                                </div>
                            </section>
                        </article>
                
                        <article class="column is-one-third-desktop is-half-tablet is-full-mobile blog-featured">
                
                            <a href="/blog/next-generation-of-serverless-is-happening"
                                title="The Next Generation of Serverless is Happening" class="blog-link">
                                <span class="image-wrap">
                                    <img class="blog-thumb"
                                        src="/static/image/twc-next-generation-of-serverless-is-happening.jpg"
                                        alt="The Next Generation of Serverless is Happening">
                                </span>
                
                                <h1 class="title">
                                    The Next Generation of Serverless is Happening
                                </h1>
                            </a>
                            <section class="blog-summary">
                                <div class="truncate">
                                    <p>The term ‚Äúserverless‚Äù is used ambiguously, so let‚Äôs start off with a specific
                                        definition. Serverless apps are applications that are...</p>
                                    <span class="fade"></span>
                                </div>
                            </section>
                        </article>
                        
                        <article class="column is-one-third-desktop is-half-tablet is-full-mobile blog-featured blog-featured-cta">
                
                            <div class="blog-cta-text-link">
                                <h2>Stay in the loop! Get updates <a href="/newsletter" class="blog-cta" title="Email Digest Newsletter">sent to your email inbox</a> or <a href="/atom">RSS</a>.</h2>
                            </a>
                        </article>
                
                    </div>
                </div> <!-- static posts -->            </div>
        </div>
    </div>
</div>

<section id="cta">
    <div class="columns is-centered">
        <div class="column is-half has-text-centered">

           <h4>Quickstart Your Serverless Apps with Spin</h4>
            <a class="main-button button is-outlined is-rounded is-medium" href="https://spinframework.dev/quickstart" target="_blank">
                Get Started 
            </a>
        </div>
    </div>
</section>
    </main>

    <footer>
        <section class="footer-wrap container">

            <div class="columns footer-links-wrap">
                <div class="column is-two-thirds is-full-touch">
                    <div class="columns is-multiline is-mobile">
                        <div class="column is-one-quarter-desktop is-full-mobile footer-links">
                            <h3>Open Source Projects</h3>
                            <a href="/spin">Spin</a>
                            <a href="https://spinkube.dev" target="_blank">SpinKube</a>
                            <a href="/open-source-promise">Open Source Promise</a>
                        </div>
                        
                        <div class="column is-one-quarter-desktop is-full-mobile footer-links">
                            <h3>Fermyon Products</h3>
                            <a href="/cloud">Cloud</a>
                            <a href="/platform">Platform for Kubernetes</a>
                            <a href="/wasm-functions">Wasm Functions</a>
                        </div>

                        <div class="column is-one-quarter-desktop is-full-mobile footer-links">
                            <h3>Resources</h3>
                            
                            <a href="https://developer.fermyon.com">Developer Docs</a>
                            <a href="/wasm-languages/webassembly-language-support/">Language Support</a>
                            <a href="/serverless-guide/">The Serverless Guide</a>
                        </div>
                        <div class="column is-one-quarter-desktop is-full-mobile footer-links">
                            <h3>Company</h3>
                            <a href="/about">About</a>
                            <a href="/contact">Contact</a>
                        </div>
                    </div>
                </div>

                <div class="column is-one-third-desktop is-full-mobile">
                    <div class="columns">

                        <div class="column footer-social has-text-centered-touch has-text-left-desktop">
                            <h2>
                                Building faster, denser cloud compute - powered by WebAssembly.
                            </h2>

                            <a href="/newsletter" class="button is-outline is-rounded plausible-event-name=cta-footer-newsletter">Subscribe to Updates</a>

                            <p>
                                <a href="https://discord.gg/AAFNfS7NGf" target="_blank" rel="noopener noreferrer" class="footer-discord" title="Join Fermyon's Discord Server"><img src="/static/image/icon/discord.svg" alt="Join Fermyon's Discord Server" /></a>
                                <a href="https://github.com/fermyon" target="_blank" rel="noopener noreferrer" class="footer-github" title="Fermyon's GitHub Page"><img src="/static/image/icon/github.svg" alt="Fermyon's GitHub Page" /></a>
                                <a href="https://www.linkedin.com/company/fermyon/" target="_blank" rel="noopener noreferrer" class="footer-linkedin" title="Follow Fermyon on LinkedIn"><img src="/static/image/icon/linkedIn.svg" alt="Follow Fermyon on LinkedIn" /></a>
                                <a href="https://bsky.app/profile/fermyon.com" target="_blank" rel="noopener noreferrer" class="footer-bsky" title="Follow @fermyon.com on Bluesky"><img src="/static/image/icon/bsky.svg" alt="Follow @fermyon.com on Bluesky" /></a>
                                <a href="https://twitter.com/fermyontech" target="_blank" rel="noopener noreferrer" class="footer-twitter" title="Follow @fermyontech on Twitter"><img src="/static/image/icon/twitter.svg" alt="Follow @fermyontech on Twitter" /></a>
                                <a href="https://www.youtube.com/@fermyontech" target="_blank" rel="noopener noreferrer" class="footer-youtube" title="Subscribe to @fermyontech on YouTube"><img src="/static/image/icon/youtube.svg" alt="Subscribe to @fermyontech on YouTube" /></a>
                                </a>
                            </p>
                        </div>

                    </div>
                </div>

            </div>
            <div class="columns is-hidden-touch">
                <div class="column is-half">
                    <img src="/static/image/fermyon-badge.png" alt="This website runs on Fermyon Cloud" class="footer-badge plausible-event-name=cta-footer-runson">
                </div>
            </div>

            <div class="container footer-nav is-hidden-mobile">
                <div class="columns">
                    <div class="column">
                        <nav class="navbar" role="navigation" aria-label="footer navigation">
                            <div class="navbar-start">
                                <div class="navbar-item"><a href="/code-of-conduct">Code of Conduct</a></div>
                                <div class="navbar-item"><a href="/legal">Legal</a></div>
                                <div class="navbar-item"><a href="/privacy-policy">Privacy</a></div>
                                <div class="navbar-item"><a href="/atom">RSS</a></div>
                                <div class="navbar-item has-text-right"><a href="/sitemap">Sitemap</a></div>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </section>
    </footer>

    <script defer src="/static/js/headroom.min.js"></script>
    <script defer src="/static/js/highlight.min.js"></script>
    <script defer src="/static/js/main.js"></script>
    <script defer data-domain="fermyon.com" src="https://plausible.io/js/script.tagged-events.js"></script>
    
    <!-- embed HS widget on sales pages -->
    <script data-type="text/javascript" id="hs-script-loader" async defer data-src="//js-na1.hs-scripts.com/21155010.js" data-name="hubspot-chat"></script>
    
    <!-- embed form spam protection and HS widget on contact pages -->

    <div class="modal modal-connect" id="getUpdates">
      <div class="modal-background"></div>
      <div class="modal-content">
        <div class="box">
          <section class="modal-wrapper">
            <h2 class="has-text-centered">Connect with Fermyon</h2>
    
            <div class="columns">
              <div class="column is-one-third-desktop is-full-touch">
                <a href="https://discord.gg/AAFNfS7NGf" target="_blank" rel="noopener noreferrer" class="connect-link">
                  <h3>Chat on Discord</h3>
                  <img src="/static/image/connect-chat.svg" class="is-hidden-touch" alt="Chat on Discord" />
                </a>
              </div>
              <div class="column is-one-third-desktop is-full-touch">
                 <a href="/demo" target="_blank" rel="noopener noreferrer" class="connect-link">
                  <h3>Schedule a Meeting</h3>
                  <img src="/static/image/connect-meeting.svg" class="is-hidden-touch" alt="Schedule a Meeting" />
                </a>
              </div>
              <div class="column is-one-third-desktop is-full-touch">
                <a href="/about/#cta" target="_blank" rel="noopener noreferrer" class="connect-link">
                  <h3>Become an Insider</h3>
                  <img src="/static/image/connect-insider.svg" class="is-hidden-touch" alt="Become an Insider" />
                </a>
              </div>
            </div>
          </section>
    
        </div>
      </div>
      <button class="modal-close is-large is-rounded" aria-label="close">Close</button>
    </div>
</body>
</html>
